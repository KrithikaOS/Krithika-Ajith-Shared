//apply from: '../gradle/dependencies.gradle'

apply plugin: 'war'
apply plugin: 'com.google.cloud.tools.appengine'

group 'com.fulllearn.backend'
version '1.0'

buildscript {
    repositories {
        jcenter()
        mavenCentral()
    }
    dependencies {
        classpath 'com.google.cloud.tools:appengine-gradle-plugin:+'
    }
}

dependencies {
    providedCompile libs.servletApi
    compile libs.gae
}

appengine {
    run {
        port = config.gae.port.backend
        storagePath = file("$projectDir/appengine-generated/")
       // datastorePath = file("$projectDir/appengine-generated/")
        jvmFlags = config.gae.defaultJvmFlags
      //  serverVersion = '2-alpha'
    }

    deploy {
        version = 3
        project = "full-learn"
        stopPreviousVersion = false
        promote = false
//        stopPreviousVersion = true
//        promote = true

    }
}

appengineDeploy.dependsOn appengineDeployQueue
appengineDeploy.dependsOn appengineDeployCron
appengineDeploy.dependsOn appengineDeployIndex

task reloadApp(type: Copy) {
    dependsOn war

    project.afterEvaluate {
        into project.tasks.explodeWar.explodedAppDirectory
        with war
    }
}